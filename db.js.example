module.exports = {
    
    init: function( config ){
        const mysql = require('mysql');
        function asyncQuery(ctx,sql){
            // resovle，reject 为回调函数，resolve 为成功的回调函数，reject 为失败的回调函数
            // resolve 对应 then，reject 对应 catch
            return new Promise( (resolve, reject) => {
                ctx.database.query(sql, function(error, results, fields){
                    if(error) reject(error)
                    else resolve(results);
                });
            });
        }
        let pool = mysql.createPool( config.mysql );
        pool.asyncQuery = asyncQuery;
        return pool;
    }

}